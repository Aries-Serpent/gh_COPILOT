# Codex Logging

This document describes how Codex sessions record activity in the repository.

## Database schema

Codex events are stored in `databases/codex_log.db`, an SQLite database with two
primary tables:

- `codex_actions`
  - `id` – integer primary key
  - `session_id` – identifier for the Codex session
  - `ts` – timestamp when the action was recorded
  - `action` – name of the action
  - `statement` – free‑form details about the action
  - `metadata` – optional JSON or text metadata
- `codex_log`
  - `session_id` – identifier for the Codex session
  - `event` – `start` or `end`
  - `summary` – optional session summary
  - `ts` – timestamp when the event was written

## Usage

Utilities in `utils/codex_log_db.py` manage the database:

```python
from utils.codex_log_db import log_codex_start, log_codex_action, log_codex_end

log_codex_start(session_id)
log_codex_action(session_id, "generate", "created script", metadata="...")
log_codex_end(session_id, "session complete")
```

The module automatically creates `codex_log.db` if it does not exist.
`GH_COPILOT_WORKSPACE` must point to the repository root so the utility can
resolve the `databases/` directory. Set `GH_COPILOT_BACKUP_ROOT` to an external
path for any backups generated by the session tooling. Setting `TEST_MODE=1`
prevents writes during test runs.

## Commit process

The log database is tracked with Git LFS. Ensure `ALLOW_AUTOLFS=1` and run
`git lfs install` once per environment. After logging a session, include the
updated database in commits:

```bash
git add databases/codex_log.db
```

Run `git lfs status` or `scripts/run_checks.py` to verify the file is managed by
LFS before committing. The `.gitattributes` file already tracks `*.db` files,
so no additional configuration is typically required.

For a broader overview of session management and how Codex logging fits in,
see the [Session Management](../README.md#session-management-cli) section of the
README.
