# Codex Logging

This document describes how Codex sessions record activity in the repository.

## Database schema

Codex events are stored in `databases/codex_log.db`, an SQLite database with a
single table:

- `codex_actions`
  - `id` – integer primary key
  - `session_id` – identifier for the Codex session
  - `ts` – timestamp when the action was recorded
  - `action` – name of the action
  - `statement` – free‑form details about the action
  - `metadata` – optional JSON or text metadata

## Usage

Utilities in `utils/codex_log_db.py` manage the database:

```python
from utils.codex_log_db import (
    init_codex_log_db,
    record_codex_action,
    finalize_codex_log_db,
)

init_codex_log_db()
record_codex_action(session_id, "generate", "created script", metadata="...")
finalize_codex_log_db()
```

The module automatically creates `codex_log.db` if it does not exist and
`finalize_codex_log_db()` copies it to `codex_session_logs.db` while staging both
files with `git add`.

### Environment variables

`GH_COPILOT_WORKSPACE` must point to the repository root so the utility can
resolve the `databases/` directory. Set `GH_COPILOT_BACKUP_ROOT` to an external
path for any backups generated by the session tooling. Use `SESSION_ID_SOURCE`
to supply a custom session identifier; when unset, a UUID is generated. Set
`TEST_MODE=1` to prevent writes during test runs.

At the end of a session, call `finalize_codex_log_db()` to copy the log to
`databases/codex_session_logs.db` for archival and commit purposes:

```python
from utils.codex_log_db import finalize_codex_log_db

finalize_codex_log_db()
```

## Commit process

The log database is tracked with Git LFS. Set `ALLOW_AUTOLFS=1` and run
`git lfs install` once per environment. After logging a session, include the
updated database in commits:

```bash
git add databases/codex_log.db
git add databases/codex_session_logs.db
```

Run `git lfs status` or `git lfs ls-files codex_log.db` to verify the file is
managed by LFS before committing. The `.gitattributes` file already tracks
`*.db` files, so no additional configuration is typically required.

For a broader overview of session management and how Codex logging fits in,
see the [Session Management](../README.md#session-management) section of the
README.
