# Codex Logging

This document describes how Codex sessions record activity in the repository.

## Database schema

Codex events are stored in `databases/codex_log.db`, an SQLite database with a
single table:

- `codex_actions`
  - `id` – integer primary key
  - `session_id` – identifier for the Codex session
  - `ts` – timestamp when the action was recorded
  - `action` – name of the action
  - `statement` – free‑form details about the action
  - `metadata` – optional JSON or text metadata

## Usage

Utilities in `utils/codex_log_db.py` manage the database:

```python
from utils.codex_log_db import log_codex_action

log_codex_action(session_id, "generate", "created script", metadata="...")
```

The module automatically creates `codex_log.db` if it does not exist. Set
`GH_COPILOT_BACKUP_ROOT` to an external path for any backups generated by the
session tooling. Setting `TEST_MODE=1` prevents writes during test runs.

At the end of a session, call `finalize_codex_log_db()` to copy the log to
`databases/codex_session_logs.db` for archival and commit purposes:

```python
from utils.codex_log_db import finalize_codex_log_db

finalize_codex_log_db()
```

## Commit process

The log database is tracked with Git LFS. Ensure `ALLOW_AUTOLFS=1` and run
`git lfs install` once per environment. After logging a session, include the
updated database in commits:

```bash
git add databases/codex_log.db
git add databases/codex_session_logs.db
```

Run `git lfs status` or `scripts/run_checks.py` to verify the file is managed by
LFS before committing. The `.gitattributes` file already tracks `*.db` files,
so no additional configuration is typically required.

For a broader overview of session management and how Codex logging fits in,
see the [Session Management](../README.md#session-management-cli) section of the
README.
